# Source configuration that generates Clash and Quantumult X configs.
global:
  proxy_check_url: &proxy-check-url http://www.google.com/generate_204
  proxy_check_interval: 300
subscriptions:
- name: WestData Cloud
  type: clash
  url: '@secret:SUBSCRIPTION_URL'
proxies:
- name: &udp-fallback üáØüáµ„ÄåSS-AES„Äçbwh-jp-01
  type: ss
  server: '@secret:JP_NODE_HOSTNAME'
  port: '@secret:NODE_SS_AES_PORT!int'
  cipher: aes-128-gcm
  password: '@secret:NODE_SS_AES_PASSWORD'
  udp: true
- name: üáØüáµ„ÄåSS-ChaCha„Äçbwh-jp-01
  type: ss
  server: '@secret:JP_NODE_HOSTNAME'
  port: '@secret:NODE_SS_CHACHA_PORT!int'
  cipher: chacha20-ietf-poly1305
  password: '@secret:NODE_SS_CHACHA_PASSWORD'
  udp: true
- name: üá≠üá∞„ÄåSS-AES„Äçbwh-hk-01
  type: ss
  server: '@secret:HK_NODE_HOSTNAME'
  port: '@secret:HK_SS_AES_PORT!int'
  cipher: aes-128-gcm
  password: '@secret:HK_SS_AES_PASSWORD'
  udp: true
- name:  üá≠üá∞„ÄåSS-ChaCha„Äçbwh-hk-01
  type: ss
  server: '@secret:HK_NODE_HOSTNAME'
  port: '@secret:HK_SS_CHACHA_PORT!int'
  cipher: chacha20-ietf-poly1305
  password: '@secret:HK_SS_CHACHA_PASSWORD'
  udp: true
rules:
- name: Guard
  type: select
  filters:
  - type: DOMAIN-SUFFIX
    arg: '@secret:DOMAIN'
  - type: DOMAIN-SUFFIX
    arg: ipify.org
  - type: PROCESS-NAME
    arg: qBittorrent
  - type: DOMAIN-SUFFIX
    arg: plex.redirect
  - type: quantumult
    url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/Filter/Special.list
  img-url: https://github.com/Koolson/Qure/raw/master/IconSet/Hijacking.png
  proxies:
  - DIRECT
  - Outside
- name: AdBlock
  type: select
  filters:
  - type: quantumult
    url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/Filter/AdBlock.list
  img-url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/IconSet/AdBlock.png
  proxies:
  - REJECT
  - Mainland
- name: Netflix
  type: select
  filters:
  - type: quantumult
    url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/Filter/Optional/Netflix.list
  img-url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/IconSet/Netflix.png
  proxies:
  - type: regex
    pattern: SG|Singapore|Êñ∞Âä†Âù°|üá∏üá¨
  - Outside
- name: Spotify
  type: select
  filters:
  - type: quantumult
    url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/Filter/Optional/Spotify.list
  img-url: https://github.com/Koolson/Qure/raw/master/IconSet/Spotify.png
  proxies:
  - type: regex
    pattern: US|United\w{0,1}States|ÁæéÂõΩ|üá∫üá∏
  - Outside
- name: Telegram
  type: select
  filters:
  - type: quantumult
    url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/Filter/Optional/Telegram.list
  img-url: https://github.com/Koolson/Qure/raw/master/IconSet/Telegram.png
  proxies:
  - Outside
  - type: regex
    pattern: SG|Singapore|Êñ∞Âä†Âù°|üá∏üá¨
- name: OpenAI
  type: select
  filters:
  - type: quantumult
    url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/Filter/Optional/ChatGPT.list
  img-url: https://aws-sg.rundong.me/assets/ChatGPT_logo.png
  proxies:
  - type: regex
    pattern: US|United\w{0,1}States|ÁæéÂõΩ|üá∫üá∏|SG|Singapore|Êñ∞Âä†Âù°|üá∏üá¨
  - Outside
- name: Outside
  type: select
  filters:
  - type: quantumult
    url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/Filter/Outside.list
  - type: DOMAIN-SUFFIX
    arg: s1s1s1.com
  - type: DOMAIN-SUFFIX
    arg: sehuatang.net
  - type: DOMAIN-KEYWORD
    arg: hegre
  img-url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/IconSet/Outside.png
  proxies:
  - PROXY
- name: Bilibili & iQIYI
  type: select
  filters:
  - type: clash-classic
    url: https://github.com/dler-io/Rules/raw/main/Clash/Provider/Media/Bilibili.yaml
  - type: clash-classic
    url: https://github.com/dler-io/Rules/raw/main/Clash/Provider/Media/IQIYI.yaml
  img-url: https://github.com/Koolson/Qure/raw/master/IconSet/iQIYI%26bilibili.png
  proxies:
  - Mainland
  - type: regex
    pattern: HK|Hong\s{0,1}Kong|È¶ôÊ∏Ø|üá≠üá∞|TW|Taiwan|Âè∞Êπæ|üáπüáº
- name: Microsoft
  type: select
  filters:
  - type: clash-classic
    url: https://github.com/dler-io/Rules/raw/main/Clash/Provider/Microsoft.yaml
  img-url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/IconSet/Microsoft.png
  proxies:
  - Mainland
  - Outside
- name: Apple
  type: select
  filters:
  - type: quantumult
    url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/Filter/Apple.list
  img-url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/IconSet/Apple.png
  proxies:
  - Mainland
  - Outside
- name: Speedtest
  type: select
  filters:
  - type: quantumult
    url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/Filter/Speedtest.list
  img-url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/IconSet/Speedtest.png
  proxies:
  - Mainland
  - Outside
- name: Mainland
  type: select
  filters:
  - type: quantumult
    url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/Filter/Mainland.list
  - type: DOMAIN-SUFFIX
    arg: smartmidea.net
  - type: DOMAIN-SUFFIX
    arg: gree.com
  - type: geoip
    arg: CN
  img-url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/IconSet/Mainland.png
  proxies:
  - DIRECT
- name: Others
  type: select
  filters:
  - type: match
  img-url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/IconSet/Others.png
  proxies:
  - PROXY
  - DIRECT
rewrites:
- name: General
  type: quantumult
  url: https://github.com/GeQ1an/Rules/raw/master/QuantumultX/Rewrite/Rewrite.list
generates:
- name: clash
  type: clash
  allow-lan: false
  ipv6: true
  socks-port: 10080
  port: 10081
- name: clash-daemon
  type: clash
  allow-lan: true
  ipv6: true
  socks-port: 10080
  port: 10081
  redir-port: 10082
  tproxy-port: 10083
  external-ui: clash-dashboard
  external-controller: :9090
  secret: '@secret:CLASH_SECRET'
  authentication:
  - '@secret:CLASH_PROXY_USERNAME:@secret:CLASH_PROXY_PASSWORD'
  dns: &DNS_CONFIG
    enable: true
    listen: :10053
    ipv6: true
    enhanced-mode: fake-ip
    fake-ip-range: 198.18.0.1/16
    fake-ip-filter:
    - '+.local'
    - '+.@secret:DOMAIN'
    - localhost.ptlogin2.qq.com
    # Otherwise MS apps and network manager will not operate properly.
    - dns.msftncsi.com
    - www.msftncsi.com
    - www.msftconnecttest.com
    # Otherwise IPv6 address acquisition will not operate properly.
    - api6.ipify.org
    default-nameserver:
    - 114.114.114.114
    nameserver:
    - tls://dot.pub
  hosts:
    # TODO: Auto-gen from hosts.
    router: 192.168.50.1
    router.rundong.local: 192.168.50.1
    gateway: 192.168.50.2
    gateway.rundong.local: 192.168.50.2
    raspberry: 192.168.50.2
    raspberry.rundong.local: 192.168.50.2
    bmc: 192.168.50.3
    bmc.rundong.local: 192.168.50.3
    pve: 192.168.50.4
    pve.rundong.local: 192.168.50.4
    truenas: 192.168.50.5
    truenas.rundong.local: 192.168.50.5
    freenas: 192.168.50.5
    freenas.rundong.local: 192.168.50.5
    synonas: 192.168.50.6
    synonas.rundong.local: 192.168.50.6
    nas: 192.168.50.6
    nas.rundong.local: 192.168.50.6
    gateway-x86: 192.168.50.7
    gateway-x86.rundong.local: 192.168.50.7
    tp-switch: 192.168.50.8
    tp-switch.rundong.local: 192.168.50.8
    TL-SG2008: 192.168.50.8
    TL-SG2008.rundong.local: 192.168.50.8
    home-assistant: 192.168.50.9
    home-assistant.rundong.local: 192.168.50.9
    ha: 192.168.50.9
    ha.rundong.local: 192.168.50.9
    plex: 192.168.50.10
    plex.rundong.local: 192.168.50.10
    plex-gpu: 192.168.50.10
    plex-gpu.rundong.local: 192.168.50.10
  tun:
    enable: true
    stack: system
    dns-hijack:
    - any:53
  profile:
    store-selected: true
    store-fake-ip: true
- name: clash-android
  type: clash
  allow-lan: false
  ipv6: true
  socks-port: 10080
  port: 10081
  dns: *DNS_CONFIG
- name: quantumult-x
  type: quantumult
  general:
    excluded_routes:
    - 192.168.0.0/16
    - 10.0.0.0/8
    - 172.16.0.0/12
    - 100.64.0.0/10
    - 17.0.0.0/8
    geo_location_checker:
    - http://ip-api.com/json/?lang=zh-CN
    - https://github.com/KOP-XIAO/QuantumultX/raw/master/Scripts/IP_API.js
    server_check_url: *proxy-check-url
    ssid_suspended_list:
    - Rundong's AP
    - Rundong's AP 5GHz
    fallback_udp_policy: *udp-fallback
  task_local:
  - name: ÊµÅÂ™í‰Ωì-Ëß£ÈîÅÊü•ËØ¢
    type: event-interaction
    url: https://github.com/KOP-XIAO/QuantumultX/raw/master/Scripts/streaming-ui-check.js
    img-url: checkmark.seal.system
  - name: GeoIP Êü•ËØ¢
    type: event-interaction
    url: https://github.com/KOP-XIAO/QuantumultX/raw/master/Scripts/geo_location.js
    img-url: location.fill.viewfinder.system
